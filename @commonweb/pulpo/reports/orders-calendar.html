<script async src="./calendar-plugin.js"></script>

<div class="flex gap-4 flex-col h-[90%]">

    <api-call method="POST" report src="https://pavlova-backend-natp7refrq-uc.a.run.app/report"></api-call>
    <div class="card">
        <strong>Filtros</strong>
        <form-group class="flex flex-wrap">
            <form-field property="fromDate" label="Desde" format="date"></form-field>
            <form-field property="toDate" label="Hasta" format="date"></form-field>
            <api-call products
                      method="GET"
                      auto="true"
                      src="https://pavlova-backend-natp7refrq-uc.a.run.app/products?page=1&size=100"></api-call>
            <bind-element
                    input-path="detail.data.content"
                    from="api-call[products]:(request-success)"
                    to="multiselect-form-field:updateOptions">
            </bind-element>
            <multiselect-form-field
                    label-path="name"
                    value-path="id"
                    property="productsIds"
                    placeholder="Seleccione Productos"
                    label="Productos">
            </multiselect-form-field>
            <multiselect-form-field
                    options='[{"name":"Completada","id":"Completed"}]'
                    label-path="name"
                    value-path="id"
                    placeholder="Seleccione Estatus"
                    property="statuses"
                    label=" Estatus">
            </multiselect-form-field>
            <button class="p-4 outline rounded text-white bg-black outline-cyan-400 h-[50px]">Buscar</button>

        </form-group>

        <bind-element from="button:(click)" to="form-group:submit"></bind-element>
        <bind-element input-path="detail.data" from="form-group:(submit)" to="api-call[report]:execute"></bind-element>
    </div>
    <div class="flex gap-2">
        <div class="flex-1 card">
            <bind-element
                    input-path="detail.data"
                    from="api-call[report]:(request-success)"
                    to="pulpo-calendar:data">
            </bind-element>


            <pulpo-calendar data="[]"></pulpo-calendar>
        </div>
        <bind-element
                input-path="detail.event.orders"
                from="pulpo-calendar:(day-clicked)"
                to="[for-each]:clearAndPush">
        </bind-element>

        <div class="flex-[0.4] card h-[100vh] overflow-auto">
            <h4>Ordenes</h4>
            <style>
                .Created {
                    color: white;
                    background: #a3a3ff;
                }

                .Completed {
                    background: #9acd32c2;
                    color: white;
                }

                .order-card {
                    padding: 1rem;
                    margin: 1rem 0;
                    background: none;
                    display: flex;
                    font-weight: 500;
                }

                .code {
                    display: flex;
                    align-items: center;
                    padding: 1rem;
                    border-right: 1px solid white;
                }

                .order-card-details {
                    padding-left: 1rem;
                }

                .order-item {
                    margin: 1rem 0;
                }
            </style>
            <div>
                <template for-each="{{@host:[data]}}">
                    <div class="order-item">
                        <div class="{{@host:[data.status]}}">
                            <div class="order-card">
                                <div class="code">
                                    {{@host:[data.orderCode]}}
                                </div>
                                <div class="order-card-details">
                                    <div><span>Status: </span>{{@host:[data.status]}}</div>
                                    <div><span>Cantidad Productos: </span>{{@host:[data.products.length]}}</div>
                                    <div><span>Total: </span> {{@host:[data.totalPrice]}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

            </div>
        </div>
    </div>
</div>
