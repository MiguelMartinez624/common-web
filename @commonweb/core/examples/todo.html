<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Todo App</title>
</head>
<script src="https://cdn.tailwindcss.com"></script>

<style>
    /* width */
    ::-webkit-scrollbar {
        width: 10px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: rgb(20, 28, 51);
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: #06b6d4;
        border-radius: 5px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #006b7d;
    }

    .loop-injected > li {
        animation: NAME-YOUR-ANIMATION 0.1s;
    }

    @-webkit-keyframes NAME-YOUR-ANIMATION {
        0%, 49% {
            background-color: white;
        }
        50%, 100% {
            background-color: none;
        }
    }

</style>
<body class="bg-slate-900 p-20 text-slate-50">
<div class="flex gap-4 justify-center">
    <div class="w-[40%] outline outline-cyan-900 p-4  margin-auto  justify-center">
        <div class="mb-[2em]">
            <web-form>
                <form action="" onsubmit="return false">
                    <div class=" ">
                        <div class="flex my-3 gap-4">
                            <form-field class="w-full" placeholder="Ej. Comprar Comida" property="name" type="text"
                                        label="Name"></form-field>
                            <form-field class="w-full" placeholder="Ej. 233" property="amount" format="number"
                                        label="Amount"></form-field>

                        </div>
                        <div class="flex my-3 gap-4">
                            <form-field class="w-full" property="date" format="date"
                                        label="Date"></form-field>
                            <form-select
                                    property="category"
                                    data='[{"value":"joystick", "label":"Gaming"},{"value":"kitchen", "label":"Food"}]'
                                    class="w-full" property="category"
                                    placeholder="Seleccione una..."
                                    label="Category"
                                    label-path="label"
                                    value-path="value">
                            </form-select>
                        </div>
                        <div class="flex gap-4">
                            <form-field class="w-full" property="description" format="teext"
                                        label="Description"></form-field>

                        </div>

                        <button class="my-3 w-[100%] bg-blue-500 border border-blue-500 hover:bg-blue-700 text-white font-bold rounded-lg p-2 ">
                            Agregar
                        </button>
                    </div>

                </form>
            </web-form>
            <bind-element
                    from="button:(click)"
                    to="web-form:submit">
            </bind-element>
            <bind-element
                    from="web-form:(submit)"
                    to="for-each:push">
            </bind-element>
            <bind-element
                    value=""
                    from="button:(click)"
                    to="web-form:reset">
            </bind-element>

        </div>
        <div class="flow-root  ">
            <ul role="list" class=" p-3  h-[40vh] overflow-y-scroll divide-y divide-gray-200 dark:divide-gray-700">
                <for-each
                        identifier-path="name"
                        html='<template-view view="http://localhost:63342/common-web/@commonweb/core/examples/todo-item.html"></template-view>'
                        data="[]">
                </for-each>
            </ul>
        </div>
    </div>

    <!--    <api-call method="GET"></api-call>-->
    <!--    <div class="w-[60%] outline outline-cyan-900 p-4  margin-auto  justify-center">-->
    <!--    </div>-->
</div>
<script src="../dist/lib-pkg.js" type="text/javascript"></script>

<script>
    if (window.RegisterWebComponent) {

        window
            .RegisterWebComponent({
                selector: 'web-form',
                template: `<slot></slot>`,
                // so we can take global style rules
            })
            .with_method("submit", function () {
                const selects = this.querySelectorAll("form-select")
                const value = {};
                const formFields = this.querySelectorAll("form-field")
                formFields.forEach((input) => value[input.getAttribute("property")] = input.value());
                selects.forEach((input) => value[input.getAttribute("property")] = input.value());

                const event = new CustomEvent("submit", {detail: {data: value}});
                this.dispatchEvent(event)
            })
            .with_method("reset", function () {
                const inputs = this.querySelectorAll("form-field")
                const select = this.querySelectorAll("select")
                inputs.forEach((input) => input.reset());
                select.forEach((input) => input.value = "");
            })
            .build();


        window
            .RegisterWebComponent({
                selector: 'form-field',
                // language=HTML
                template: `
                    <label for="">{{@host.label}}</label>
                    <input
                            placeholder="{{@host.placeholder}}"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                            type="{{@host.format}}">`,
                useShadow: false,

                // so we can take global style rules,
            })
            .with_attribute("placeholder", "")
            .with_attribute("format", "text")
            .with_attribute("label", "")
            .with_attribute("property", "")
            .with_attribute("value", function () {
                return this.querySelector("input").value;
            })
            .with_method("reset", function () {
                this.querySelector("input").value = "";
            })
            .with_method("setValue", function (value) {
                this.querySelector("input").value = value;
            })
            .build();


        window
            .RegisterWebComponent({
                //language=CSS
                style: `
                    .content {
                        position: relative;
                    }

                    .option-list {
                        position: absolute;
                        max-height: 200px;
                        overflow: auto;
                        width: 100%;
                    }

                    .option {
                        background-color: rgb(55 65 81 / var(--tw-bg-opacity));
                        color: white;
                        padding: 1em 0.5em;
                    }

                    .option:hover {
                        background-color: rgb(54 117 219);

                    }

                    .overlay {
                        top: 0;
                        position: fixed;
                        height: 100%;
                        width: 100%;
                        left: 0;
                    }

                    ul {
                        border: none;
                        list-style: none;
                    }
                `,
                selector: 'form-select',
                // language=HTML
                template: `

                    <div class="content">
                        <form-field placeholder="Select" label="{{@host.label}}"></form-field>
                        <bind-element from=input:(focus) to="toggable-element:show"></bind-element>

                        <bind-element from=form-field:(click) to="toggable-element:show"></bind-element>
                        <bind-element from=ul:(click) to="toggable-element:hide"></bind-element>

                        <toggable-element hidden>
                            <div class="overlay"></div>
                            <bind-element from=.overlay:(click) to="toggable-element:hide"></bind-element>
                            <ul class="option-list bg-gray-50 border text-gray-900 cursor-pointer">
                            </ul>
                        </toggable-element>
                    </div>
                `,
                useShadow: false,
            })
            .with_attribute("label-path", "")
            .with_attribute("value-path", "")
            .with_attribute("placeholder", "")
            .with_attribute("label", "")
            .with_attribute("property", "")
            .with_attribute("data", function (data) {
                this._data = data;
            })
            .with_method("value", function () {
                return this._value;
            })
            .with_method("reset", function () {
                if (!this['label-path'] || !this['value-path']) {
                    return;
                }
                if (this._data && Array.isArray(this._data)) {
                    this._data.forEach((item) => {
                        const li = document.createElement("li");
                        // language=HTML
                        const option = `
                            <div value="{{@host.data.${this['value-path']}}}">{{@host.data.${this['label-path']}}}
                            </div>`
                        li.innerHTML = `<template-view></template-view>`;
                        li.classList.add("option")
                        li.children.item(0).setAttribute("data", JSON.stringify(item));
                        li.children.item(0).view = option;


                        li.addEventListener("click", () => {
                            const selected = li.children.item(0).children.item(0);
                            this._value = selected.getAttribute("value");
                            this.querySelector("form-field").setValue(selected.textContent);
                        });


                        this.querySelector(".option-list").appendChild(li);
                    });
                }

            })
            .on_init(function () {
                this.reset();
            })
            .build();

    }

</script>
</body>
</html>
